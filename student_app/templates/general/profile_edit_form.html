{% load static %}

<form id="profileEditForm" method="post" enctype="multipart/form-data" data-url="{% url 'edit_profile' %}">
    {% csrf_token %}
    
    <div class="row">
        <!-- Profile Picture Section -->
        <div class="col-md-4 text-center mb-4">
            <div class="profile-picture-section">
                <div class="current-avatar mb-3">
                    {% if user_profile.avatar %}
                        <img id="currentAvatar" src="{{ user_profile.avatar.url }}" alt="Current Avatar" class="avatar-preview" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                        <div id="currentAvatarPlaceholder" class="avatar-placeholder" style="display: none;">
                            <span class="avatar-initials">{{ user.get_full_name|slice:":2"|upper|default:user.username|slice:":2"|upper }}</span>
                        </div>
                    {% else %}
                        <div id="currentAvatar" class="avatar-placeholder">
                            <span class="avatar-initials">{{ user.get_full_name|slice:":2"|upper|default:user.username|slice:":2"|upper }}</span>
                        </div>
                    {% endif %}
                </div>
                <div class="avatar-upload">
                    <input type="file" id="id_avatar" name="avatar" accept="image/*" class="form-control" onchange="previewImage(this)">
                    <label for="id_avatar" class="btn btn-outline-primary btn-sm mt-2">
                        <i class="fas fa-camera me-1"></i>Change Photo
                    </label>
                </div>
                <small class="text-muted d-block mt-2">Max 2MB, JPG/PNG/GIF</small>
            </div>
        </div>
        
        <!-- Form Fields -->
        <div class="col-md-8">
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="{{ form.first_name.id_for_label }}" class="form-label">
                        <i class="fas fa-user me-1"></i>{{ form.first_name.label }}
                    </label>
                    {{ form.first_name }}
                    {% if form.first_name.errors %}
                        <div class="text-danger small">{{ form.first_name.errors.0 }}</div>
                    {% endif %}
                </div>
                <div class="col-md-6 mb-3">
                    <label for="{{ form.last_name.id_for_label }}" class="form-label">
                        <i class="fas fa-user me-1"></i>{{ form.last_name.label }}
                    </label>
                    {{ form.last_name }}
                    {% if form.last_name.errors %}
                        <div class="text-danger small">{{ form.last_name.errors.0 }}</div>
                    {% endif %}
                </div>
            </div>
            
            <div class="mb-3">
                <label for="{{ form.email.id_for_label }}" class="form-label">
                    <i class="fas fa-envelope me-1"></i>{{ form.email.label }}
                </label>
                {{ form.email }}
                {% if form.email.errors %}
                    <div class="text-danger small">{{ form.email.errors.0 }}</div>
                {% endif %}
            </div>
            
            <div class="mb-3">
                <label for="{{ form.faculty.id_for_label }}" class="form-label">
                    <i class="fas fa-university me-1"></i>{{ form.faculty.label }}
                </label>
                {{ form.faculty }}
                {% if form.faculty.errors %}
                    <div class="text-danger small">{{ form.faculty.errors.0 }}</div>
                {% endif %}
            </div>
            
            <div class="mb-3">
                <label for="{{ form.bio.id_for_label }}" class="form-label">
                    <i class="fas fa-info-circle me-1"></i>{{ form.bio.label }}
                </label>
                {{ form.bio }}
                {% if form.bio.errors %}
                    <div class="text-danger small">{{ form.bio.errors.0 }}</div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- Form Actions -->
    <div class="d-flex justify-content-end gap-2 mt-4 pt-3 border-top">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            <i class="fas fa-times me-1"></i>Cancel
        </button>
        <button type="submit" class="btn btn-primary" id="saveProfileBtn">
            <i class="fas fa-save me-1"></i>Save Changes
        </button>
    </div>
</form>

<style>
.profile-picture-section {
    position: relative;
}

.avatar-preview, .avatar-placeholder {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    object-fit: cover;
    border: 4px solid #e9ecef;
    margin: 0 auto;
    display: block;
}

.avatar-placeholder {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 3rem;
    color: white;
    font-weight: 600;
}

.avatar-initials {
    font-size: 2.5rem;
    font-weight: 700;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
}

.avatar-upload input[type="file"] {
    display: none;
}

.form-label {
    font-weight: 600;
    color: #495057;
    margin-bottom: 0.5rem;
}

.form-control, .form-select {
    border-radius: 8px;
    border: 2px solid #e9ecef;
    transition: all 0.3s ease;
}

.form-control:focus, .form-select:focus {
    border-color: #667eea;
    box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
}

.btn {
    border-radius: 8px;
    font-weight: 500;
    transition: all 0.3s ease;
}

.btn-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border: none;
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
}

.btn-outline-primary {
    border-color: #667eea;
    color: #667eea;
}

.btn-outline-primary:hover {
    background-color: #667eea;
    border-color: #667eea;
}
</style>

<script>
function previewImage(input) {
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const currentAvatar = document.getElementById('currentAvatar');
            if (currentAvatar.tagName === 'IMG') {
                currentAvatar.src = e.target.result;
            } else {
                // Replace placeholder with image
                const img = document.createElement('img');
                img.src = e.target.result;
                img.alt = 'Avatar Preview';
                img.className = 'avatar-preview';
                img.id = 'currentAvatar';
                currentAvatar.parentNode.replaceChild(img, currentAvatar);
            }
        };
        reader.readAsDataURL(input.files[0]);
    }
}
</script>
